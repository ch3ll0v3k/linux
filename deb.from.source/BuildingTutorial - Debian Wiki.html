<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<link rel="shortcut icon" href="/htdocs/favicon.ico">
<script type="text/javascript" src="/htdocs/bugstatus.js"></script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>BuildingTutorial - Debian Wiki</title>
<script type="text/javascript" src="/htdocs/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debwiki/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/htdocs/debwiki/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/htdocs/debwiki/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/htdocs/debwiki/css/projection.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debian-wiki-1.0.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/htdocs/debwiki/css/msie.css">
<![endif]-->


<link rel="alternate" title="Debian Wiki: BuildingTutorial" href="/BuildingTutorial?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=BuildingTutorial&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/FrontPage">
<link rel="Alternate" title="Wiki Markup" href="/BuildingTutorial?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/BuildingTutorial?action=print">
<link rel="Search" href="/FindPage">
<link rel="Index" href="/TitleIndex">
<link rel="Glossary" href="/WordIndex">
<link rel="Help" href="/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">
<div id="logo"><a href="https://www.debian.org" title="Debian Homepage"><img src="https://www.debian.org/Pics/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>
<div id="header">
<div id="wikisection">
<p class="section"><a href="/FrontPage" title="Debian Wiki Homepage">Wiki</a></p>
<div id="username"><a href="/BuildingTutorial?action=login" id="login" rel="nofollow">Login</a></div>
</div>
<div id="navbar">

<ul id="navibar">
<li class="wikilink"><a href="/FrontPage">FrontPage</a></li><li class="wikilink"><a href="/RecentChanges">RecentChanges</a></li><li class="wikilink"><a href="/FindPage">FindPage</a></li><li class="wikilink"><a href="/HelpContents">HelpContents</a></li><li class="current"><a href="/BuildingTutorial">BuildingTutorial</a></li>
</ul>

</div>

<form id="searchform" method="get" action="/BuildingTutorial">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="https://www.debian.org" title="Debian Homepage"><img src="https://www.debian.org/Pics/openlogo-50.png" alt="Debian" width="50" height="61"></a></div>

<div id="breadcrumbs"><a href="/FrontPage" title="Debian Wiki Homepage">Wiki</a><span class="sep">/</span>

</div>

<ul class="editbar"><li><a href="/BuildingTutorial?action=login" id="login-1" rel="nofollow">Login</a></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="/BuildingTutorial?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="/BuildingTutorial?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/BuildingTutorial">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<h1 id="locationline">


<ul id="pagelocation">
<li><a href="/BuildingTutorial">BuildingTutorial</a></li>
</ul>

</h1>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><small><a href="/DebianWiki/EditorGuide#translation">Translation(s)</a>:  English - <a href="/es/BuildingTutorial">Español</a> - <a href="/it/BuildingTutorial">Italiano</a> -  <a href="/pt_BR/BuildingTutorial">Português Brasileiro</a></small> <span class="anchor" id="line-4"></span><hr /><p class="line874"> <span class="anchor" id="line-5"></span><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#Requirements">Requirements</a><ol><li>
<a href="#configure_apt">configure apt</a></li><li>
<a href="#create_a_working_directory">create a working directory</a></li><li>
<a href="#Choose_the_package">Choose the package</a></li></ol></li><li>
<a href="#The_packaging_workflow">The packaging workflow</a><ol><li>
<a href="#Get_the_source_package">Get the source package</a></li><li>
<a href="#Get_the_build_dependencies">Get the build dependencies</a></li><li>
<a href="#Rebuild_without_changes">Rebuild without changes</a></li><li>
<a href="#Edit_the_source_code">Edit the source code</a></li><li>
<a href="#Building_the_modified_package">Building the modified package</a></li><li>
<a href="#Installing_and_testing_the_modified_package">Installing and testing the modified package</a></li><li>
<a href="#Building_the_source_package">Building the source package</a></li><li>
<a href="#Sending_your_changes_to_the_BTS">Sending your changes to the BTS</a></li></ol></li><li>
<a href="#Conclusions">Conclusions</a><ol><li>
<a href="#That.27s_it.2C_get_ready_for_the_next_package">That's it, get ready for the next package</a></li><li>
<a href="#Feedback">Feedback</a></li><li>
<a href="#Questions_and_Answers">Questions and Answers</a></li><li>
<a href="#See_also">See also</a></li></ol></li></ol></li></ol></div> <span class="anchor" id="line-6"></span><hr /><p class="line874"> <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867">
<h2 id="Introduction">Introduction</h2>
<span class="anchor" id="line-9"></span><p class="line867"><small>This tutorial is based on a <a class="http" href="http://women.debian.org">Debian Women</a> <a href="/DebianWomen/BuildItEvent">Build it Event</a> held by Margarita Manterola (in collaboration with the <a class="http" href="http://openhatch.org/">OpenHatch project</a>) on 07-May-2011 </small> <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">This tutorial is about taking an existing package, re-building it, applying changes to it, and preparing those changes so that you can send them to a bug as a patch. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line867">
<h2 id="Requirements">Requirements</h2>
<span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">You need very little previous knowledge for this tutorial, just no fear of the command line <img alt=":-)" height="16" src="/htdocs/debwiki/img/smile.png" title=":-)" width="16" /> <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line874">Technical requirements: <span class="anchor" id="line-18"></span><ul><li>You should have a working Debian distribution or a Debian based distribution. <span class="anchor" id="line-19"></span></li><li><p class="line862">You should have administration rights in this computer (either root or <a class="interwiki" href="https://packages.debian.org/sudo" title="DebianPkg">sudo</a>). Every time that admin rights are needed, we'll include <tt>sudo</tt> in front. If you don't use <tt>sudo</tt>, just get the rights whatever way you like.  <span class="anchor" id="line-20"></span></li><li><p class="line891"><a class="interwiki" href="https://packages.debian.org/build-essential" title="DebianPkg">build-essential</a> <span class="anchor" id="line-21"></span></li><li><p class="line891"><a class="interwiki" href="https://packages.debian.org/fakeroot" title="DebianPkg">fakeroot</a> <span class="anchor" id="line-22"></span></li><li><p class="line891"><a class="interwiki" href="https://packages.debian.org/devscripts" title="DebianPkg">devscripts</a> <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span></li></ul><p class="line874">Remember: <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><pre><span class="anchor" id="line-1"></span>   sudo apt-get install build-essential fakeroot devscripts</pre><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line867">
<h3 id="configure_apt">configure apt</h3>
<span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line862">Once you have installed the needed packages, the next thing that you need to do, is make sure that you have some <strong>source repositories</strong> configured in your computer.   <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line862">Open your <strong>/etc/apt/sources.list</strong> file and check if you have one or more lines that start with <strong>deb-src</strong>.   <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867"><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><div class="blue solid"><span class="anchor" id="line-1-1"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">deb-src&nbsp;http://httpredir.debian.org/debian&nbsp;unstable&nbsp;main</tt> </li></ul></div><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line874">This line is needed in order to work with source packages.  <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">If you don't have any <em>deb-src</em> lines, you'll need to add at least one . This is usually achieved by copying one of the existing <em>deb</em> lines and changing it to <em>deb-src</em>. You can do that by running an editor with admin rights (<tt>sudo&nbsp;gedit</tt>, <tt>sudo&nbsp;kate</tt> or <tt>sudo&nbsp;vim</tt>). <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line862">Usually, it's a good idea to use <strong>unstable</strong> as the repository, since you'll be working with the latest version of the package. <span class="anchor" id="line-44"></span>But if you intend to modify a package as it is in <strong>stable</strong> or <strong>testing</strong> you could use those distributions as well. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line874">If you use stable/testing/whatever as your running distribution, getting source from unstable won't affect it. <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line874">Once you've added the line, you'll need to do  <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line867"><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><pre><span class="anchor" id="line-1-1"></span>   sudo apt-get update</pre><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><p class="line874">in order to update the list of packages available for installation. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line867">
<h3 id="create_a_working_directory">create a working directory</h3>
<span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">With the sources URL added to your apt repositories, you'll now be able to get the source of <strong>any Debian package that you like</strong>.  <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line874">For this particular tutorial, we are going to download the source of one package and make a small modification to it, so that it works better. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line862">It's always a good idea to have a directory that you use to work with source software, separated from other directories used for other stuff.  In case you don't already have one, I'd suggest that you create a directory <em>src</em> with another one called <em>debian</em> inside it: <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line867"><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><pre><span class="anchor" id="line-1-2"></span>   mkdir -p src/debian/; cd src/debian</pre><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line874">Inside this directory we will get the source of the package that we want to work with.  <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867">
<h3 id="Choose_the_package">Choose the package</h3>
<span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line862">In this example, we'll use a package called <a class="interwiki" href="https://packages.debian.org/fdupes" title="DebianPkg">fdupes</a>, a tool to detect duplicate files, and we will be fixing the <a class="interwiki" href="https://bugs.debian.org/585426" title="DebianBug">Debian bug 585426</a>. <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line874">You should install the package (or check if you have it installed and up to the latest version) before proceeding, since you'll need to have the dependencies sorted up when you want to install the modified one.  <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><p class="line862">If you don't have <a class="interwiki" href="https://packages.debian.org/fdupes" title="DebianPkg">fdupes</a> installed, you can do this by doing: <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line867"><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><pre><span class="anchor" id="line-1-3"></span>   sudo apt-get install fdupes</pre><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line874">and check that the bug is still present.  You can do that by running  <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line867"><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><pre><span class="anchor" id="line-1-4"></span>   fdupes --help</pre><p class="line874"> <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line862">and checking that the second line of info for the <em>--debug</em> option still doesn't make any sense. <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><p class="line867">
<h2 id="The_packaging_workflow">The packaging workflow</h2>
<span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line867">
<h3 id="Get_the_source_package">Get the source package</h3>
<span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line862">In order to <strong>get the source</strong> of <a class="interwiki" href="https://packages.debian.org/fdupes" title="DebianPkg">fdupes</a>, what you need to do is go to your chosen directory (<tt>src/debian</tt> in this example) and do (as normal user):  <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><p class="line867"><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><pre><span class="anchor" id="line-1-5"></span>   apt-get source fdupes</pre><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><p class="line862">You have now downloaded the 3 files (<em>.dsc</em>, <em>.tar.gz</em>, <em>.diff.gz</em>), composing the <strong>Debian source package</strong>. <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line862">It probably also informed you that <a class="interwiki" href="https://packages.debian.org/fdupes" title="DebianPkg">fdupes</a> is maintained with <em>Git</em>. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line862">Once the package is downloaded, you can check the directory where you are (typing <tt>ls</tt>), and you'll find that apart from the 3 files that were downloaded you also have a directory, called <strong>fdupes-1.50-PR2</strong>.  This is the <strong>unpacked source</strong> of the Debian package.  <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><p class="line874">To enter that directory, type:  <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line867"><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><pre><span class="anchor" id="line-1-6"></span>   cd fdupes-1.50-PR2/ </pre><p class="line874"> <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line862">When you check the contents of this directory (typing <tt>ls</tt> again), you'll see quite a number of files of different sorts, and a <strong>debian directory</strong>. <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line862">Every Debian (or Debian derivative) package includes a <em>debian</em> directory, where all the information related to the Debian package is stored. Anything that's outside of that directory, is the <strong>upstream code</strong>, i.e. the original code released by whoever programmed the software. <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">Go into the <strong>debian</strong> directory, by typing  <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867"><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><pre><span class="anchor" id="line-1-7"></span>  cd debian</pre><p class="line874"> <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line874">This is the directory that the package maintainer has added to the source code to build the package.   <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line862">In this directory you'll usually find lots of files related to Debian's version of the program, Debian specific patches, manpages, documentation, and so on. We won't be going any deeper about these files here. Look at its contents by typing <tt>ls</tt>. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line874">Just keep in mind that  <span class="anchor" id="line-128"></span><ul><li><p class="line862">the <strong>rules</strong> file is the executable file that we will be running in order to build the package.  <span class="anchor" id="line-129"></span></li><li><p class="line862">in the <strong>patches</strong> directory, there are also a number of patches applied by the maintainer  <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span></li></ul><p class="line874">Let's move one directory back, by doing  <span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line867"><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><pre><span class="anchor" id="line-1-8"></span>   cd ..</pre><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><p class="line862">You should be again at <strong>fdupes-1.50-PR2</strong>, the main directory of the source code. <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line867">
<h3 id="Get_the_build_dependencies">Get the build dependencies</h3>
<span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line862">In order to build almost any program, you will need some <strong>dependencies</strong> installed.  <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line862">The dependencies are the programs or libraries needed to compile your program. Usually it's a bunch of packages that end in <em>-dev</em>, but it might also be other things like <a class="interwiki" href="https://packages.debian.org/automake" title="DebianPkg">automake</a> or <a class="interwiki" href="https://packages.debian.org/gcc" title="DebianPkg">gcc</a>, depending on how many development tools you've ever installed in that machine. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line867"><a class="interwiki" href="https://packages.debian.org/apt" title="DebianPkg">apt</a> provides a way of easily installing all the needed dependencies:  <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line867"><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><pre><span class="anchor" id="line-1-9"></span>   sudo apt-get build-dep fdupes</pre><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line874">Once you've downloaded these tools, you'll be ready to build the package. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line867">
<h3 id="Rebuild_without_changes">Rebuild without changes</h3>
<span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line862">Before making any changes to the code, let's <strong>build the package</strong> as it is right now, just to make sure that it builds and it installs properly. Do:  <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867"><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><pre><span class="anchor" id="line-1-10"></span>   debuild -b -uc -us</pre><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line874">The extra parameters are to build a binary only package (.deb) and prevent it from signing the package, since we don't need to sign it right now. <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line862">This command will probably take a while to run, since usually it first has to run <tt class="backtick">./configure</tt>, then it has to compile the source code and then build the packages. In fact, it will run the commands that are listed in the <em>debian/rules</em> file and will hopefully end with a message like:  <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line867"><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-1-2"></span><div class="highlight console"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-2f4e68361772b533f196b5ad642ac99214314719" lang="en"><span class="line"><span class="anchor" id="line-1-3"></span><span class="LineNumber">   dpkg-deb: building package `fdupes' in `../fdupes_1.50-PR2-3_&lt;your arch&gt;.deb'</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span><span class="LineNumber"></span></span>
</pre></div></div><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line862">In your own language. &lt;your arch&gt; can be <em>i386</em>, <em>amd64</em>, depending on which architecture you are running your machine on. <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line862">Once the package has correctly built, the next step is to <strong>install this file</strong> with:  <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><p class="line867"><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><pre><span class="anchor" id="line-1-11"></span>   sudo dpkg -i ../fdupes_1.50-PR2-3_&lt;your arch&gt;.deb</pre><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line862">After that, <strong>check that the bug is still present</strong>, running  <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><pre><span class="anchor" id="line-1-12"></span>   fdupes --help</pre><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><p class="line867">
<h3 id="Edit_the_source_code">Edit the source code</h3>
<span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><p class="line862">Now, we want to actually <strong>fix this bug</strong>.  <span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><p class="line874">Here comes the fun part. When you are trying to fix a package bug, sometimes it will be located in the upstream source, sometimes it will be related to how the program was packaged for Debian. So you'll be editing different files depending on where the problem is. <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><p class="line862">In this particular case, the package uses the <a class="interwiki" href="https://packages.debian.org/dpatch" title="DebianPkg">dpatch</a> tool, a tool to manage patches for the package, so we will make use of that tool. Other packages use a different tool, called <a class="interwiki" href="https://packages.debian.org/quilt" title="DebianPkg">quilt</a>, to manage patches, but we won't be covering that one in this tutorial. <span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><p class="line874">To create a new patch, you'll need to do the following. Type:  <span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><p class="line867"><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><pre><span class="anchor" id="line-1-13"></span>   dpatch-edit-patch 80_bts585426_fix_help 70_bts537138_disambiguate_recurse.dpatch</pre><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><p class="line862">This will start a new shell inside a special environment, where you can edit your files and <em>dpatch</em> will afterwards take care of getting the differences with the original.   <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><ul><li>the first parameter is the name assigned to the new patch :  80_bts585426_fix_help <span class="anchor" id="line-199"></span></li><li>the second parameter is the last patch that should be applied before applying the new one : 70_bts537138_disambiguate_recurse.dpatch <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span></li></ul><p class="line874">The name of the patch was chosen to match the pattern already established by the maintainer. <span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><p class="line862">Now we need to edit the <strong>fdupes.c</strong> file. Go to the line 1066 and delete it. The line says:  <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><p class="line867"><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><div class="blue solid"><span class="anchor" id="line-1-4"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">printf(&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\teach&nbsp;set&nbsp;of&nbsp;duplicates&nbsp;without&nbsp;prompting&nbsp;the&nbsp;user\n&quot;);</tt> </li></ul></div><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><p class="line862">You can edit the file with your preferred editor (<tt>vi&nbsp;fdupes.c</tt>, <tt>gedit&nbsp;fdupes.c</tt>, <tt>kate&nbsp;fdupes.c</tt>, etc).  <span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line874">Once you are done, you should type into the console : <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line867"><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><pre><span class="anchor" id="line-1-14"></span>   exit</pre><p class="line874"> <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><p class="line862">It will end the special environment that <em>dpatch</em> created for us, and you'll have a new patch in the <strong>debian/patches/</strong> directory.  Check it out with:  <span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line867"><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><pre><span class="anchor" id="line-1-15"></span>   cat debian/patches/80_bts585426_fix_help.dpatch</pre><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><p class="line862">In order for this patch to get applied, you'll need to edit the <strong>debian/patches/00list</strong> file, and add after the last line : <span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><p class="line867"><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><div class="blue solid"><span class="anchor" id="line-1-5"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">80_bts585426_fix_help</tt> </li></ul></div><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><p class="line862">The <em>00list</em> file is the <em>dpatch</em> file that lists all the patches that will be applied.  They are applied in order, from the one appearing in the first line, till the one appearing in the last line. <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line862">Before rebuilding the package with this patch, we want to <strong>make our package different from the original one</strong>, so that we can afterwards extract the changes in order to send them as a patch to the bug. In order to do this, type:  <span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><p class="line867"><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><pre><span class="anchor" id="line-1-16"></span>   dch -n</pre><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><p class="line874">This will  <span class="anchor" id="line-238"></span><ul><li><p class="line862">add a new entry in the <em>changelog</em> file, maybe with your name (depending on other configurations that we are not going to cover), with the current date,  <span class="anchor" id="line-239"></span></li><li>and open the changelog with the configured command-line editor.  <span class="anchor" id="line-240"></span><ul><li><p class="line862">In case this is vi, and it's your first time with vi, you can start editing by pressing the <em>Insert key</em>, and after you are finished, you can save an close by pressing: <em>ESC :wq</em> <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span></li></ul></li></ul><p class="line862">So, you are editing the <strong>changelog</strong> file now. What you have to enter in this file is some description of the change that we've made. For example:  <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><p class="line867"><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><div class="blue solid"><span class="anchor" id="line-1-6"></span><ul><li style="list-style-type:none"><p class="line891"><tt class="backtick">Added&nbsp;a&nbsp;patch&nbsp;to&nbsp;fix&nbsp;the&nbsp;--help&nbsp;issue&nbsp;with&nbsp;the&nbsp;--debug&nbsp;option.&nbsp;Closes:&nbsp;#585426&quot;.</tt>   </li></ul></div><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line862">Do this in the line with the empty <em>*</em>. <span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><p class="line867">
<h3 id="Building_the_modified_package">Building the modified package</h3>
<span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><p class="line874">Once this is done, just build the package again with the same command as before: <span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><p class="line867"><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><pre><span class="anchor" id="line-1-17"></span>   debuild -b -uc -us</pre><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><p class="line874">Add -tc option if you want to clean build artifacts. <span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><p class="line862">In the case that you need to debug the compiled package, particularly if it's a <em>Segmentation Fault</em> that you are trying to fix, you might want to compile it like this, so that the code is not optimized and not stripped and it's easier to debug: <span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><p class="line867"><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><pre><span class="anchor" id="line-1-18"></span>   DEB_BUILD_OPTIONS='nostrip noopt debug' dpkg-buildpackage -b -uc -us</pre><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line874">You'll see a some compiling output on screen.  This is usually not very interesting, unless you are looking for a bug that is related to the compilation of the package itself. Normally, I just let this go while I do something else (grab some cookies for your coffee, for example). <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><p class="line862">This time, the package created should be: <tt>../fdupes_1.50-PR2-3.1_&lt;your&nbsp;arch&gt;.deb</tt>, the version changed because <tt>dch</tt> changed it for us in the changelog (-3.1 instead of -3). <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line867">
<h3 id="Installing_and_testing_the_modified_package">Installing and testing the modified package</h3>
<span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><p class="line867"><strong>Install</strong> it with: <span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><p class="line867"><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><pre><span class="anchor" id="line-1-19"></span>   sudo dpkg -i ../fdupes_1.50-PR2-3.1_&lt;your arch&gt;.deb</pre><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><p class="line862">and <strong>test</strong> that the help is now correct. <img alt=":)" height="16" src="/htdocs/debwiki/img/smile.png" title=":)" width="16" /> <span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><p class="line874">If in any case what you've done has made things worst, you can always revert to Debian's version by doing: <span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><pre><span class="anchor" id="line-1-20"></span>  apt-get install --reinstall fdupes=&lt;previous_version&gt;</pre><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><p class="line867">
<h3 id="Building_the_source_package">Building the source package</h3>
<span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><p class="line862">Once a bug is fixed, you might want to also <strong>build the source package</strong>. This means not only the .deb file, but the other files that we downloaded at the beginning.  This is done with:  <span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><p class="line867"><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><pre><span class="anchor" id="line-1-21"></span>   debuild -us -uc</pre><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><p class="line862">If you've built the source package, go to the previous directory with <tt>cd&nbsp;..</tt> and check the files there with <tt>ls</tt>. You'll see that you have more files there now, including 2 <em>dsc</em> files, one for the original package and one for the one you just made. <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><p class="line867">
<h3 id="Sending_your_changes_to_the_BTS">Sending your changes to the BTS</h3>
<span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><p class="line862">Once you've built any source package, you can <strong>find out the difference between your package and the original one</strong>, by using <a class="interwiki" href="https://packages.debian.org/debdiff" title="DebianPkg">debdiff</a>:  <span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><p class="line867"><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><pre><span class="anchor" id="line-1-22"></span>   debdiff fdupes_1.50-PR2-3.dsc fdupes_1.50-PR2-3.1.dsc &gt; my_first_debdiff.diff</pre><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line862">In this particular case, since we used the dpatch tool, what we would send to the BTS as a patch is the <em>dpatch file</em> that we created, because the change that we made is enclosed there. <span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><p class="line862">But if we hadn't used <em>dpatch</em>, we could use the output of that <tt>debdiff</tt> and send that to the BTS. <span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><p class="line867">
<h2 id="Conclusions">Conclusions</h2>
<span class="anchor" id="line-308"></span><p class="line867">
<h3 id="That.27s_it.2C_get_ready_for_the_next_package">That's it, get ready for the next package</h3>
<span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><p class="line874">You're done with modifying the package, you can now keep fixing bugs in other Debian packages! These are the important commands you'll need to remember: <span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><p class="line867"><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><pre><span class="anchor" id="line-1-23"></span>   apt-get source the-package
<span class="anchor" id="line-2"></span>   apt-get build-dep the-package
<span class="anchor" id="line-3"></span>   (...)
<span class="anchor" id="line-4"></span>   fakeroot debian/rules binary
<span class="anchor" id="line-5"></span>   dpkg -i the-package-blabla.deb
<span class="anchor" id="line-6"></span>   dpkg-buildpackage -us -uc
<span class="anchor" id="line-7"></span>   debdiff package-blabla.dsc package-blabla.1.dsc &gt; another_debdiff.diff</pre><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><p class="line867">
<h3 id="Feedback">Feedback</h3>
<span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><p class="line862">I hope you enjoyed the tutorial, please <a class="mailto" href="mailto:marga@debian.org">send me your feedback</a> if you feel like it, or modify this wiki if you want to add some useful information I might have left out. <span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><p class="line867">
<h3 id="Questions_and_Answers">Questions and Answers</h3>
<span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><p class="line867"><strong>QUESTION:</strong> Is the number 80_ in the name of the patch a cosmetic thing? <span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><p class="line874">ANSWER: It's so that you can get them in order when you list them with ls.  The order of application is the order in which they appear in the 00list file. Some maintainers choose to give them numbers, some don't.  But when you are patching a package, you should try to follow whichever pattern the maintainer chose. <span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><p class="line867"><strong>QUESTION:</strong> About dpatch-edit-patch params, where did you get your params? I mean the bts**** <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><p class="line874">ANSWER: The first one is the name of the patch.  I chose a name similar to the other ones.  &quot;bts&quot; stands for &quot;bug tracking system&quot;, the number is the bug number that we are closing. <span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><p class="line867"><strong>QUESTION:</strong> How does dch pick the number &quot;3.1&quot;? <span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><p class="line862">ANSWER: We used <tt>dch&nbsp;-n</tt>, because we are not the maintainer of the package (n stands for non-maintainer).  Then it's 3.1.  If you were the maintainer, you'd have done <tt>dch&nbsp;-i</tt>, and it would have chosen -4 <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><p class="line867"><strong>QUESTION:</strong> When sending a patch to the BTS, do we send anything about the changelog? <span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><p class="line874">ANSWER: Not necessarily, but you can send that too, it depends on the bug that you are fixing. Sending the debdiff output is always acceptable. <span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><p class="line874">If you're sending only a small and simple patch it's normal to let the maintainer write the changelog; if it's a big NMU update then yes you should send the changelog as part of your big patch to the BTS. <span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><p class="line867"><strong>QUESTION:</strong> Sending a changelog with a NMU is considered not polite? <span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><p class="line874">ANSWER: What some (not all) maintainers don't like is if when someone actually uploads an NMU.  Sending a patch to the BTS is always/immer/siempre/sempre well received! <span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><p class="line867"><strong>QUESTION:</strong> What is the quickest/easiest way to find out which tool (if any) is used to manage patches? <span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><p class="line874">ANSWER: If there's a build dependency on quilt or dpatch in debian/control. Or if there's a debian/README.source file. <span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><p class="line867"><strong>QUESTION:</strong> Does this workflow work for all packages? <span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><p class="line874">ANSWER: The workflow is quite general.  The only thing that might change is the patch management system (dpatch/quilt/none). The rest is basically always the same. <span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><p class="line867">
<h3 id="See_also">See also</h3>
<span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><ul><li><p class="line862">If you want to go on a little bit further in your package making, you can read some of the <a href="/AdvancedBuildingTips">AdvancedBuildingTips</a> <span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span></li><li class="gap"><p class="line862">You can find a tutorial about creating new packages for Debian at <a href="/IntroDebianPackaging">IntroDebianPackaging</a> <span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span></li><li class="gap"><p class="line891"><a href="/Packaging">Packaging</a> is the page that gather everything about packaging on this wiki <span class="anchor" id="line-365"></span></li></ul><span class="anchor" id="bottom"></span></div><div id="pagebottom"></div>
</div>


<div id="footer">
<p id="pageinfo" class="info" lang="en" dir="ltr">BuildingTutorial  (last edited 2016-03-22 05:17:05 by <span title="jasonblewis"><a class="nonexistent" href="/jasonblewis" title="jasonblewis">?</a>jasonblewis</span>)</p>

<ul id="credits">
<li><a href="https://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="https://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li>Debian Wiki <a href="/Teams/DebianWiki">team</a>, <a href="https://bugs.debian.org/wiki.debian.org">bugs</a> and <a href="https://git.debian.org/?p=collab-maint/wiki.debian.org.git;a=summary">config</a> available.</li><li>Hosting provided by <a href="https://www.dg-i.net/">Dembach Goo Informatik GmbH &amp; Co KG</a></li>
</ul>


</div>
</body>
</html>

